CMAKE_MINIMUM_REQUIRED ( VERSION 2.6 )
IF (COMMAND cmake_policy)
	cmake_policy (SET CMP0011 NEW)
ENDIF (COMMAND cmake_policy)
PROJECT ( Jabber )
SET ( QT_MIN_VERSION "4.6.0" )

SET ( CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake_modules/" )
add_subdirectory("${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/gloox/" "${CMAKE_CURRENT_BINARY_DIR}/3rdparty/gloox/")
set ( gloox_src_dir "${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/gloox/src/" )
set ( gloox_include_dir "${CMAKE_CURRENT_BINARY_DIR}/3rdparty/gloox/include/gloox/" )
file( MAKE_DIRECTORY ${gloox_include_dir} )
file( GLOB GLOOX_HEADERS "${gloox_src_dir}*.h" )
foreach( HEADERS_GENERATE ${GLOOX_HEADERS} )
string( REPLACE ${gloox_src_dir} "" HEADER_FILE ${HEADERS_GENERATE} )
file( RELATIVE_PATH HEADER_PATH ${gloox_include_dir} ${HEADERS_GENERATE} )
if ( NOT EXISTS "${gloox_include_dir}${HEADER_FILE}" )
file ( WRITE "${gloox_include_dir}${HEADER_FILE}" "#include \"${HEADER_PATH}\"" )
endif ()
endforeach( HEADERS_GENERATE )

include_directories("${CMAKE_CURRENT_BINARY_DIR}/3rdparty/gloox/include/")

set(QUTIM_PATH "" CACHE FILEPATH "Path to qutim sources")
if(QUTIM_PATH)
    set(QUTIM_INCLUDE_DIRS ${QUTIM_PATH}/libqutim/include)
    set(QUTIM_LIBRARY_DIR ${QUTIM_PATH}/libqutim/)
    set(QUTIM_CMAKE_PLUGIN ${QUTIM_PATH}/cmake/QutimPlugin.cmake)
else(QUTIM_PATH)
    set(QUTIM_CMAKE_PLUGIN ${CMAKE_ROOT}/Modules/QutimPlugin.cmake)
endif(QUTIM_PATH)

SET( QT_USE_QTNETWORK TRUE )
set ( USE_TESTS OFF )

ADD_DEFINITIONS( -DGLOOX_IMPORTS )

include( ${QUTIM_CMAKE_PLUGIN} )
ADD_QUTIMPLUGIN_EXT2( "jabber" "src" "" gloox )
