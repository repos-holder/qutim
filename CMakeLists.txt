cmake_minimum_required (VERSION 2.6 FATAL_ERROR)
if( COMMAND cmake_policy )
	cmake_policy( SET CMP0003 NEW )
endif(COMMAND cmake_policy )
project( Protocols )
set(QT_MIN_VERSION "4.6.0")

if ( ${CMAKE_CURRENT_SOURCE_DIR} EQUAL ${CMAKE_SOURCE_DIR} )
	set(QUTIM_PATH "" CACHE FILEPATH "Path to qutim sources")
	set(QUTIM_LIBRARY QUTIM_LIBRARY-NOTFOUND CACHE FILEPATH "Path to qutim library")
endif ( ${CMAKE_CURRENT_SOURCE_DIR} EQUAL ${CMAKE_SOURCE_DIR} )
if(QUTIM_PATH)
    if(NOT QUTIM_INCLUDE_DIRS)
        set(QUTIM_INCLUDE_DIRS ${QUTIM_PATH}/libqutim/include)
    endif(NOT QUTIM_INCLUDE_DIRS)
    if(NOT QUTIM_LIBRARY_DIR)
        set(QUTIM_LIBRARY_DIR ${QUTIM_PATH}/libqutim/)
    endif(NOT QUTIM_LIBRARY_DIR)
    if(NOT QUTIM_CMAKE_PLUGIN)
        set(QUTIM_CMAKE_PLUGIN ${QUTIM_PATH}/cmake/QutimPlugin.cmake)
    endif(NOT QUTIM_CMAKE_PLUGIN)
else(QUTIM_PATH)
    set(QUTIM_CMAKE_PLUGIN ${CMAKE_ROOT}/Modules/QutimPlugin.cmake)
endif(QUTIM_PATH)

include( "${QUTIM_CMAKE_PLUGIN}" )

file( GLOB PROTOCOLS RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}/" "${CMAKE_CURRENT_SOURCE_DIR}/*" )

foreach( PROTOCOL ${PROTOCOLS} )
	if( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/${PROTOCOL}" AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/${PROTOCOL}/CMakeLists.txt" )
		string( TOUPPER ${PROTOCOL} PROTOCOL_NAME)
		option( ${PROTOCOL_NAME} "" ON )
		if( ${PROTOCOL_NAME} )
			message( "+ protocol '${PROTOCOL_NAME}' added to build" )
			add_subdirectory( "${CMAKE_CURRENT_SOURCE_DIR}/${PROTOCOL}" "${CMAKE_CURRENT_BINARY_DIR}/${PROTOCOL}" ) 
		else( ${PROTOCOL_NAME} )
			message( "- protocol '${PROTOCOL_NAME}' will be skipped" )
		endif( ${PROTOCOL_NAME} )
	endif( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/${PROTOCOL}" AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/${PROTOCOL}/CMakeLists.txt" )
endforeach( PROTOCOL )

