include_directories(.
	chatlayer
	)

qutim_add_plugin(adiumchat
	SUBPLUGIN
	SOURCE_DIR chatlayer
	DISPLAY_NAME "Webkit chat layer"
	DESCRIPTION "Default qutIM chat implementation, based on Adium chat styles"
	LINK_LIBRARIES ${QT_QTWEBKIT_LIBRARY}
	COMPILE_FLAGS "-DADIUMCHAT_LIBRARY"
	INCLUDE_DIRS ${QT_QTWEBKIT_INCLUDE_DIR}
)

FILE( GLOB PLUGINS RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}/chatforms" "${CMAKE_CURRENT_SOURCE_DIR}/chatforms/*" )

FOREACH( PLUGIN ${PLUGINS} )
	IF( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/chatforms/${PLUGIN}" AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/chatforms/${PLUGIN}/CMakeLists.txt" )
		STRING( TOUPPER ADIUMCHAT/${PLUGIN} PLUGIN_NAME)
		OPTION( ${PLUGIN_NAME} "" ON )
		IF( ${PLUGIN_NAME} )
			MESSAGE( "+ chatform '${PLUGIN_NAME}' added to build" )
			ADD_SUBDIRECTORY( ${CMAKE_CURRENT_SOURCE_DIR}/chatforms/${PLUGIN} ${CMAKE_CURRENT_BINARY_DIR}/chatforms/${PLUGIN})
		ELSE( ${PLUGIN_NAME} )
			MESSAGE( "- chatform '${PLUGIN_NAME}' will be skipped" )
		ENDIF( ${PLUGIN_NAME} )
	ENDIF( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/chatforms/${PLUGIN}" AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/chatforms/${PLUGIN}/CMakeLists.txt" )
ENDFOREACH( PLUGIN )


FILE( GLOB PLUGINS RELATIVE "${CMAKE_CURRENT_SOURCE_DIR}/chatfactories" "${CMAKE_CURRENT_SOURCE_DIR}/chatfactories/*" )

FOREACH( PLUGIN ${PLUGINS} )
	IF( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/chatfactories/${PLUGIN}" AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/chatfactories/${PLUGIN}/CMakeLists.txt" )
		STRING( TOUPPER ADIUMCHAT/${PLUGIN} PLUGIN_NAME)
		OPTION( ${PLUGIN_NAME} "" ON )
		IF( ${PLUGIN_NAME} )
			MESSAGE( "+ chatfactory '${PLUGIN_NAME}' added to build" )
			ADD_SUBDIRECTORY( ${CMAKE_CURRENT_SOURCE_DIR}/chatfactories/${PLUGIN} ${CMAKE_CURRENT_BINARY_DIR}/chatfactories/${PLUGIN})
		ELSE( ${PLUGIN_NAME} )
			MESSAGE( "- chatfactory '${PLUGIN_NAME}' will be skipped" )
		ENDIF( ${PLUGIN_NAME} )
	ENDIF( IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/chatfactories/${PLUGIN}" AND EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/chatfactories/${PLUGIN}/CMakeLists.txt" )
ENDFOREACH( PLUGIN )
